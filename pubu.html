<!DOCTYPE html>
<html lang="en">
<head>
	<meta charset="UTF-8">
	<title>javascript�ٲ���</title>
	<style type="text/css">
		*{
			margin: 0px;
			padding: 0px;
		}
		.container {
			position: relative;
			width: 40%;
			margin: 0px auto;
		}
		.box {
			padding: 5px;
			float: left;
		}
		.box_img {
			padding: 5px;
			border: 1px solid #cccccc;
			box-shadow: 0 0 5px #ccc;
			border-radius: 5px;
		}
		.box_img img {
			width: 150px;
			height: auto;
		}
	</style>
</head>
<body>
	<div class="container" id="container">
		<div class="box">
			<div class="box_img"><img src="image/1.jpg" alt="">5555</div>
		</div>
		<div class="box">
			<div class="box_img"><img src="image/2.jpg" alt=""></div>
		</div>
		<div class="box">
			<div class="box_img"><img src="image/3.jpg" alt=""></div>
		</div>
		<div class="box">
			<div class="box_img"><img src="image/4.jpg" alt=""></div>
		</div>
		<div class="box">
			<div class="box_img"><img src="image/5.jpg" alt=""></div>
		</div>
		<div class="box">
			<div class="box_img"><img src="image/6.jpg" alt=""></div>
		</div>
		<div class="box">
			<div class="box_img"><img src="image/7.jpg" alt=""></div>
		</div>
		<div class="box">
			<div class="box_img"><img src="image/8.jpg" alt=""></div>
		</div>
		<div class="box">
			<div class="box_img"><img src="image/9.jpg" alt=""></div>
		</div>
		<div class="box">
			<div class="box_img"><img src="image/10.jpg" alt=""></div>
		</div>
		<div class="box">
			<div class="box_img"><img src="image/11.jpg" alt=""></div>
		</div>
		<div class="box">
			<div class="box_img"><img src="image/12.jpg" alt=""></div>
		</div>
		<div class="box">
			<div class="box_img"><img src="image/13.jpg" alt=""></div>
		</div>
		<div class="box">
			<div class="box_img"><img src="image/14.jpg" alt=""></div>
		</div>
		<div class="box">
			<div class="box_img"><img src="image/15.jpg" alt=""></div>
		</div>
	</div>
</body>
<script type="text/javascript">
	window.onload = function() {
    img_location("container", "box");
    var img_data = {
    	"data":[{
    		"src":"1.jpg"
    	},{
    		"src":"2.jpg"
    	},{
    		"src":"3.jpg"
    	},{
    		"src":"4.jpg"
    	},{
    		"src":"5.jpg"
    	},{
    		"src":"6.jpg"
    	},{
    		"src":"7.jpg"
    	},{
    		"src":"8.jpg"
    	},{
    		"src":"9.jpg"
    	},{
    		"src":"10.jpg"
    	},{
    		"src":"11.jpg"
    	},{
    		"src":"12.jpg"
    	},{
    		"src":"13.jpg"
    	},{
    		"src":"14.jpg"
    	},{
    		"src":"15.jpg"
    	}]
    }
    window.onscroll = function(){
    	if(check_csroll()){
    		var dparent = document.getElementById("container");
    		for(var i = 0;i<img_data.data.length;i++){
    			var dcontent = document.createElement("div");//�����ڵ�
    			dcontent.className = "box";//Ϊ�ڵ��������
    			dparent.appendChild(dcontent);//��Ӹ�Ԫ��
    			var boximg = document.createElement("div");//�����ڵ�
    			boximg.className = "box_img";//Ϊ�ڵ��������
    			dcontent.appendChild(boximg);//��Ӹ�Ԫ��
    			var img = document.createElement("img");//�����ڵ�
    			img.src = "image/"+img_data.data[i].src;//ͼƬ����·��
    			boximg.appendChild(img);//��Ӹ�Ԫ��
			}
    	}
    }
}
function check_csroll(){
	var dparent = document.getElementById("container");//��ȡ��Ԫ��
	var dcontent = get_child_element(dparent,"box");//��ȡ��Ԫ�ظ���
	var last_content_height = dcontent[dcontent.length-1].offsetTop;//��ȡ���һ��ͼƬ�����ľ���
	var scroll_top = document.documentElement.scrollTop || document.body.scrollTop;//��ȡ�����������ľ���
	var page_height = document.documentElement.clientHeight || document.body.clientHeight;//��ȡ��Ļ�߶�
	if(last_content_height<scroll_top+page_height){
		return true;
	}
}
function img_location(parent, content) {
    //ȡ��parent�µ�����contentȫ����Ԫ��
    var dparent = document.getElementById(parent); //��ȡ��Ԫ��
    var dcontent = get_child_element(dparent, content); //�����Ԫ�ظ���
    //console.log(dcontent)

    var dec_width = get_width(dparent, dcontent); //�̶����
    var image_location = min_image_locatin(dec_width, dcontent) //��ͼƬ���ڸ߶���͵�ͼƬ��


}

function get_child_element(parent, content) { //�����Ԫ�ظ���
    var content_array = []; //��������
    var all_content = parent.getElementsByTagName("*"); //ȡ�ø�Ԫ���µĵ�������Ԫ��
    for (var i = 0; i < all_content.length; i++) { //����������Ԫ��
        if (all_content[i].className == content) { //�ж���Ԫ�ص������Ƿ����box
            content_array.push(all_content[i]) //�������׷��Ԫ��
        }
    }
    return content_array;
}

function get_width(dparent, dcontent) { //�̶����
    var img_width = dcontent[1].offsetWidth; //��ȡͼƬ���
    var win_width = dparent.offsetWidth;
    /*var win_width = document.documentElement.clientWidth; //��ȡ��Ļ���*/
    var num_width = Math.floor(win_width / img_width); //���һ�Űڵĸ��� ��Math.floor()ת��Ϊ����
    dparent.style.cssText = "width:" + img_width * num_width + "px; margin:0 auto"; //�̶���Ļ�ĸ߲����þ���
    return num_width;

}

function min_image_locatin(dec_width, dcontent) {
    var box_height_array = [];
    for (var i = 0; i < dcontent.length; i++) { //��������ͼƬ
        if (i < dec_width) {
            box_height_array[i] = dcontent[i].offsetHeight; //ȡ�õ�һ��ͼƬ�ĸ߶�
        } else {
            var min_height = Math.min.apply(null, box_height_array); //��ȡ��һ��ͼƬ�и߶���С��ͼƬ
            var min_index = get_min_height(box_height_array, min_height) //������ø߶���С��ͼƬ��λ��
            dcontent[i].style.position = "absolute"; //���Զ�λͼƬ
            dcontent[i].style.top = min_height + "px"; //ͼƬ�ඥ������
            dcontent[i].style.left = dcontent[min_index].offsetLeft + "px"; //ͼƬ���������
            box_height_array[min_index] = box_height_array[min_index] + dcontent[i].offsetHeight; //��СͼƬ�ĸ߶ȼ�����������ͼƬ�ĸ߶�
        }
    }

}

function get_min_height(box_height_array, min_height) {
    for (var i in box_height_array) {
        if (box_height_array[i] == min_height) { //ѭ����������ĸ߶� ����������СͼƬ�ĸ߶� ����iֵ
            return i;
        }
    }
}
</script>
</html>
